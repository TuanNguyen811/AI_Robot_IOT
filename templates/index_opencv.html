<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Control</title>
    <link rel="stylesheet" href="/static/css/opencv_style.css">
</head>
<body>
    <div class="container">
        <h1>Robot Control</h1>
        
        <!-- Picker Indicator -->
        <div class="picker-ind" id="picker-ind"></div>
        
        <div class="main-layout">
            <!-- Left: Video + Status + Measure -->
            <div class="video-section">
                <div class="video-container">
                    <img id="video-stream" src="/video_feed" alt="Video">
                    <div class="video-overlay">
                        <span class="badge" id="badge-auto">AUTO: ON</span>
                        <span class="badge" id="badge-fps">FPS: --</span>
                    </div>
                </div>
                
                <!-- Status & Measure Bar -->
                <div class="info-bar">
                    <!-- Status Panel -->
                    <div class="info-panel">
                        <h4>Status</h4>
                        <div class="status-grid">
                            <div class="stat">
                                <label>State</label>
                                <div class="val" id="stat-state">--</div>
                            </div>
                            <div class="stat">
                                <label>Command</label>
                                <div class="val" id="stat-cmd">--</div>
                            </div>
                            <div class="stat">
                                <label>Markers</label>
                                <div class="val" id="stat-markers">--</div>
                            </div>
                            <div class="stat">
                                <label>Green</label>
                                <div class="val" id="stat-green">--</div>
                            </div>
                            <div class="stat">
                                <label>Marker Dist</label>
                                <div class="val" id="stat-marker-dist">--</div>
                            </div>
                            <div class="stat">
                                <label>Green Dist</label>
                                <div class="val" id="stat-green-dist">--</div>
                            </div>
                            <div class="stat">
                                <label>BIN Dist</label>
                                <div class="val" id="stat-bin-dist">--</div>
                            </div>
                            <div class="stat">
                                <label>BIN Angle</label>
                                <div class="val" id="stat-bin-angle">--</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Measure Panel -->
                    <div class="info-panel">
                        <h4>Measure Tools</h4>
                        <div class="measure-grid">
                            <div class="measure-box" id="measure-bin" onclick="startMeasure('bin')">
                                <div class="lbl">BIN Position & Radius</div>
                                <div class="measure-inputs">
                                    <input type="number" id="bin-x" value="200" onchange="saveConfigSilent()" class="coord" placeholder="X">
                                    <input type="number" id="bin-y" value="360" onchange="saveConfigSilent()" class="coord" placeholder="Y">
                                    <span>r:</span>
                                    <input type="number" id="bin-r" value="120" onchange="saveConfigSilent()" class="small" placeholder="R">
                                </div>
                            </div>
                            <div class="measure-box" id="measure-marker" onclick="startMeasure('marker')">
                                <div class="lbl">Marker Min Dist</div>
                                <div class="measure-inputs">
                                    <input type="number" id="marker-dist-tol" value="150" onchange="saveConfigSilent()">
                                    <span>¬±</span>
                                    <input type="number" id="marker-dist-range" value="20" onchange="saveConfigSilent()" class="small">
                                </div>
                            </div>
                            <div class="measure-box" id="measure-pickup" onclick="startMeasure('pickup')">
                                <div class="lbl">Pickup Dist (max)</div>
                                <input type="number" id="pickup-dist-tol" value="80" onchange="saveConfigSilent()">
                            </div>
                        </div>
                        <div class="measure-hint">Click box then draw on video to measure</div>
                    </div>
                </div>
            </div>
            
            <!-- Right: Sidebar -->
            <div class="sidebar">
                <!-- Color Config -->
                <div class="panel">
                    <div class="panel-title">Color Detection</div>
                    <div class="color-list">
                        <div class="color-row">
                            <div class="color-swatch" id="swatch-red" style="background:#f00"></div>
                            <div class="color-info">
                                <div class="color-name">RED</div>
                                <div class="color-rgb" id="rgb-red">(255, 0, 0)</div>
                            </div>
                            <button class="pick-btn" data-color="red" onclick="startPicking('red')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L12 6M12 18L12 22M2 12L6 12M18 12L22 12"/>
                                    <circle cx="12" cy="12" r="4"/>
                                </svg>
                            </button>
                        </div>
                        <div class="color-row">
                            <div class="color-swatch" id="swatch-green" style="background:#0f0"></div>
                            <div class="color-info">
                                <div class="color-name">GREEN</div>
                                <div class="color-rgb" id="rgb-green">(0, 255, 0)</div>
                            </div>
                            <button class="pick-btn" data-color="green" onclick="startPicking('green')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L12 6M12 18L12 22M2 12L6 12M18 12L22 12"/>
                                    <circle cx="12" cy="12" r="4"/>
                                </svg>
                            </button>
                        </div>
                        <div class="color-row">
                            <div class="color-swatch" id="swatch-blue" style="background:#00f"></div>
                            <div class="color-info">
                                <div class="color-name">BLUE</div>
                                <div class="color-rgb" id="rgb-blue">(0, 0, 255)</div>
                            </div>
                            <button class="pick-btn" data-color="blue" onclick="startPicking('blue')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2L12 6M12 18L12 22M2 12L6 12M18 12L22 12"/>
                                    <circle cx="12" cy="12" r="4"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Picked Preview -->
                    <div class="picked-box" id="picked-box">
                        <div class="picked-swatch" id="picked-swatch"></div>
                        <div class="picked-info">
                            RGB: <span id="picked-rgb">--</span><br>
                            HSV: <span id="picked-hsv">--</span>
                        </div>
                    </div>
                </div>
                
                <!-- HSV Tolerance -->
                <div class="panel">
                    <div class="panel-title">HSV Tolerance</div>
                    <div class="tol-grid">
                        <div class="tol-item">
                            <label>H</label>
                            <input type="range" id="tol-h" min="1" max="90" value="15">
                            <div class="val" id="tol-h-val">¬±15</div>
                        </div>
                        <div class="tol-item">
                            <label>S</label>
                            <input type="range" id="tol-s" min="1" max="127" value="80">
                            <div class="val" id="tol-s-val">¬±80</div>
                        </div>
                        <div class="tol-item">
                            <label>V</label>
                            <input type="range" id="tol-v" min="1" max="127" value="80">
                            <div class="val" id="tol-v-val">¬±80</div>
                        </div>
                    </div>
                </div>
                
                <!-- Manual Control -->
                <div class="panel">
                    <div class="panel-title">Manual Control</div>
                    <div class="auto-row">
                        <button class="act-btn off" id="btn-auto" onclick="toggleAuto()">Auto OFF</button>
                        <button class="act-btn" onclick="resetState()">Reset State</button>
                        <button class="act-btn emergency" onclick="emergencyStop()">üõë STOP</button>
                    </div>
                    <div class="manual-section" id="manual-section">
                        <div class="ctrl-label">Movement</div>
                        <div class="ctrl-grid">
                            <button class="ctrl-btn" id="btn-spin-left" onclick="toggleMove('SPIN_LEFT')">Quay tr√°i</button>
                            <button class="ctrl-btn fwd" id="btn-forward" onclick="toggleMove('MOVE_FORWARD')">Ti·∫øn</button>
                            <button class="ctrl-btn" id="btn-spin-right" onclick="toggleMove('SPIN_RIGHT')">Quay ph·∫£i</button>
                            <button class="ctrl-btn lr" id="btn-left" onclick="toggleMove('TURN_LEFT')">R·∫Ω tr√°i</button>
                            <button class="ctrl-btn stop" onclick="sendCmd('STOP')">STOP</button>
                            <button class="ctrl-btn lr" id="btn-right" onclick="toggleMove('TURN_RIGHT')">R·∫Ω ph·∫£i</button>
                            <div></div>
                            <button class="ctrl-btn" id="btn-backward" onclick="toggleMove('MOVE_BACKWARD')">L√πi</button>
                            <div></div>
                        </div>
                        <div class="ctrl-label">Bow & Gripper</div>
                        <div class="ctrl-grid-2">
                            <button class="ctrl-btn" onclick="sendCmd('BOW_DOWN')">C√∫i xu·ªëng</button>
                            <button class="ctrl-btn" onclick="sendCmd('BOW_UP')">C√∫i l√™n</button>
                            <button class="ctrl-btn" onclick="sendCmd('GRIP_CLOSE')">ƒê√≥ng k·∫πp</button>
                            <button class="ctrl-btn" onclick="sendCmd('GRIP_OPEN')">M·ªü k·∫πp</button>
                        </div>
                        <div class="ctrl-label">Combo Actions</div>
                        <div class="ctrl-grid-2">
                            <button class="ctrl-btn combo" onclick="sendCmd('COMBO_PICK')">C√∫i + K·∫πp + Nh·∫•c</button>
                            <button class="ctrl-btn combo" onclick="sendCmd('COMBO_DROP')">C√∫i + Nh·∫£ + Ng·∫©ng</button>
                        </div>
                    </div>
                    <div class="manual-disabled" id="manual-disabled">
                        <p>T·∫Øt Auto ƒë·ªÉ ƒëi·ªÅu khi·ªÉn th·ªß c√¥ng</p>
                    </div>
                </div>
                
                <!-- Config -->
                <div class="panel">
                    <div class="panel-title">Robot Config</div>
                    <div class="cfg-grid">
                        <div class="cfg-item">
                            <label>IP</label>
                            <input type="text" id="cfg-ip" value="192.168.1.23">
                        </div>
                        <div class="cfg-item">
                            <label>Password</label>
                            <input type="text" id="cfg-pw" value="5613">
                        </div>
                        <button class="save-btn" onclick="saveConfig()">Save Config</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/js/opencv_app.js"></script>
</body>
</html>
